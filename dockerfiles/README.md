# Dockerfiles

These are the files you need to build Docker images, which is needed to spawn containers.

## Before You Begin

### Install Docker

Make sure you have Docker. I personally prefer Debian way over [docker.com way](https://docs.docker.com/engine/install/). To ensure proper operation, you can either prepend all docker command with `sudo` or follow the Docker [Post-Installation Guide](https://docs.docker.com/engine/install/linux-postinstall/). **Be aware of [Docker security scopes](https://docs.docker.com/engine/security/#docker-daemon-attack-surface) and [Rootless operations](https://docs.docker.com/engine/security/rootless/)**.

```bash
sudo apt install -y docker.io

# Make sure to follow Post-Installation steps!!!
```

### Install nvidia-docker-2

Make sure you have `nvidia-docker-2` installed if you are using NVIDIA hardware acceleration. Check their [installation instruction](https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#docker). By default, the image (and subsequently containers spawned from the image) assume that you are using a machine with CUDA-enabled NVIDIA GPUs.

For more information, check out [Using Hardware Acceleration with Docker](http://wiki.ros.org/docker/Tutorials/Hardware%20Acceleration).

### Set host user `dialout` permission

On a host terminal, make sure that the user has access to pseudo-devices generated by Robotiq and UR RS485 `socat` communication. Since Docker container will be "assimilating" the host network device as its own, this is necessary to establish connection with the RS485 gripper port on the UR arm.

```bash
sudo usermod -a -G dialout $USER
```

## Building Instructions

```bash
cd Robosim-Docker
docker build -t robosim:latest -f ./dockerfiles/Dockerfile.noetic .
```

This will build the image named `robosim` with the tag `latest` ready to use for backend ROS planning. For more information, check out [docker build](https://docs.docker.com/engine/reference/commandline/build/) documentation.

## Running Instructions

The given shell script in `scripts/run_robosim_container.sh` will handle spawning appropriate container.

```bash
sh scripts/run_robosim_container.sh

# or

sh [path_to_repo]/scripts/run_robosim_container.sh
```

First run of the script will spawn the container in detached mode (curent terminal is not inside container), with subsequent runs will attach a bash shell inside the container. You will see your terminal prompt change.

```bash
# external shell
$

# container shell
/root/
> 
```